<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Instalador - Servitel</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3e78b2',
                        secondary: '#004ba8',
                        background: '#deefb7',
                        neutral: '#bcabae',
                        dark: '#0f0f0f',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f3f4f6; }
        .form-input {
            width: 100%;
            padding: 0.625rem 0.75rem;
            border-radius: 0.375rem;
            border: 2px solid #e5e7eb;
            background-color: white;
            transition: all 0.2s;
            outline: none;
            font-size: 0.875rem;
        }
        .form-input:focus {
            border-color: #3e78b2;
            box-shadow: 0 0 0 1px #3e78b2;
        }
        .form-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            color: #6b7280;
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        /* Toggle Switch Styles */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #3e78b2;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #3e78b2;
        }
    </style>
</head>
<body class="text-dark bg-gray-50 min-h-screen flex flex-col">

    <!-- HEADER -->
    <header class="h-16 bg-white shadow-sm flex items-center justify-between px-6 border-b border-gray-200 sticky top-0 z-10">
        <div class="flex items-center gap-3">
            <a href="#" onclick="history.back()" class="text-gray-500 hover:text-primary transition-colors"><i class="fa-solid fa-arrow-left"></i></a>
            <div>
                <h1 class="text-xl font-bold text-primary flex items-center gap-2">
                    Editar Instalador
                </h1>
            </div>
        </div>
        <div class="flex items-center gap-3">
            <span class="px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700 border border-green-200" id="headerStatusBadge">ACTIVO</span>
            <img src="https://ui-avatars.com/api/?name=Admin&background=004ba8&color=fff" class="w-8 h-8 rounded-full">
        </div>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="flex-1 p-6 max-w-6xl mx-auto w-full">
        
        <form id="editInstallerForm" onsubmit="guardarCambios(event)">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                <!-- COLUMNA IZQUIERDA (2/3): INFORMACIÓN PERSONAL -->
                <div class="lg:col-span-2 space-y-6">
                    
                    <!-- TARJETA: DATOS PERSONALES -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="bg-gray-50/50 border-b border-gray-100 px-6 py-4 flex items-center gap-2">
                            <i class="fa-solid fa-user-tag text-secondary"></i>
                            <h3 class="font-semibold text-secondary">Información Personal</h3>
                        </div>
                        <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                            
                            <!-- Nombre -->
                            <div>
                                <label class="form-label">Nombre <span class="text-red-500">*</span></label>
                                <input type="text" id="name" name="name" class="form-input" required>
                            </div>

                            <!-- Apellido -->
                            <div>
                                <label class="form-label">Apellido <span class="text-red-500">*</span></label>
                                <input type="text" id="surname" name="surname" class="form-input" required>
                            </div>

                            <!-- Teléfono -->
                            <div>
                                <label class="form-label">Teléfono <span class="text-red-500">*</span></label>
                                <div class="relative">
                                    <i class="fa-solid fa-phone absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
                                    <input type="text" id="phone" name="phone" class="form-input pl-9" placeholder="04xx-xxxxxxx" required>
                                </div>
                            </div>

                            <!-- Email -->
                            <div>
                                <label class="form-label">Correo Electrónico <span class="text-red-500">*</span></label>
                                <div class="relative">
                                    <i class="fa-solid fa-envelope absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
                                    <input type="email" id="email" name="email" class="form-input pl-9" required>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- TARJETA: CREDENCIALES DE ACCESO -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="bg-gray-50/50 border-b border-gray-100 px-6 py-4 flex items-center gap-2">
                            <i class="fa-solid fa-key text-secondary"></i>
                            <h3 class="font-semibold text-secondary">Credenciales de Acceso (App Móvil)</h3>
                        </div>
                        <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                            
                            <!-- Usuario -->
                            <div>
                                <label class="form-label">Nombre de Usuario <span class="text-red-500">*</span></label>
                                <input type="text" id="username" name="username" class="form-input bg-gray-50" readonly>
                                <p class="text-[10px] text-gray-400 mt-1">El usuario no se puede modificar.</p>
                            </div>

                            <!-- Contraseña -->
                            <div>
                                <label class="form-label">Contraseña</label>
                                <div class="relative">
                                    <input type="password" id="password" name="password" class="form-input pr-10" placeholder="••••••••">
                                    <button type="button" onclick="togglePassword()" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-primary">
                                        <i class="fa-solid fa-eye" id="eyeIcon"></i>
                                    </button>
                                </div>
                                <p class="text-[10px] text-gray-400 mt-1">Déjalo en blanco para mantener la actual.</p>
                            </div>

                        </div>
                    </div>

                </div>

                <!-- COLUMNA DERECHA (1/3): ESTADO Y ASIGNACIÓN -->
                <div class="space-y-6">
                    
                    <!-- TARJETA DE GESTIÓN OPERATIVA -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden flex flex-col h-fit sticky top-24">
                        <div class="bg-background/40 border-b border-background px-6 py-4">
                            <h3 class="font-semibold text-secondary">Gestión Operativa</h3>
                        </div>
                        <div class="p-6 space-y-6">
                            
                            <!-- Estado (Active/Inactive) -->
                            <div>
                                <label class="form-label">Estado de la Cuenta</label>
                                <select id="status" name="status" class="form-input appearance-none cursor-pointer font-medium" onchange="updateHeaderBadge()">
                                    <option value="active">Activo</option>
                                    <option value="inactive">Inactivo</option>
                                </select>
                                <p class="text-xs text-gray-400 mt-1">Si está inactivo, no podrá acceder a la app.</p>
                            </div>

                            <!-- On Duty (Switch) -->
                            <div class="flex items-center justify-between bg-blue-50 p-3 rounded-lg border border-blue-100">
                                <div>
                                    <span class="text-sm font-bold text-blue-900 block">En Guardia (On Duty)</span>
                                    <span class="text-xs text-blue-600">Disponible para emergencias</span>
                                </div>
                                <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                    <input type="checkbox" name="onDuty" id="onDuty" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                    <label for="onDuty" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                                </div>
                            </div>

                            <hr class="border-gray-100">

                            <!-- Asignación de Cuadrilla (Current Crew) -->
                            <div>
                                <label class="form-label text-secondary flex items-center gap-1">
                                    <i class="fa-solid fa-users"></i> Asignar a Cuadrilla
                                </label>
                                <div class="relative mt-1">
                                    <select id="currentCrew" name="currentCrew" class="form-input pl-3 pr-10 appearance-none cursor-pointer">
                                        <option value="">-- Trabajo Individual (Sin Cuadrilla) --</option>
                                        <option value="crew_a">Cuadrilla Alfa (Norte)</option>
                                        <option value="crew_b">Cuadrilla Beta (Sur)</option>
                                        <option value="crew_c">Cuadrilla de Emergencia</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-gray-500">
                                        <i class="fa-solid fa-chevron-down text-xs"></i>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-400 mt-2">
                                    Al asignar una cuadrilla, el inventario personal podría fusionarse con el de la cuadrilla.
                                </p>
                            </div>

                            <!-- Botones -->
                            <div class="pt-4 flex flex-col gap-3 mt-auto">
                                <button type="submit" class="w-full bg-primary hover:bg-secondary text-white font-bold py-3 px-4 rounded-lg shadow-lg shadow-primary/20 transition-all flex items-center justify-center gap-2 transform active:scale-[0.98]">
                                    <i class="fa-solid fa-save"></i> Guardar Cambios
                                </button>
                                <button type="button" onclick="history.back()" class="w-full bg-white hover:bg-gray-50 text-gray-600 font-medium py-3 px-4 rounded-lg border border-gray-200 hover:border-gray-300 transition-all">
                                    Cancelar
                                </button>
                            </div>

                        </div>
                    </div>

                    <!-- Resumen Inventario (Read Only) 
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 opacity-75">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-sm font-bold text-gray-600 uppercase">Inventario Asignado</h4>
                            <a href="#" class="text-xs text-primary hover:underline">Gestionar</a>
                        </div>
                        <div class="flex gap-2 flex-wrap">
                            <span class="px-2 py-1 bg-gray-100 rounded text-xs text-gray-600 border border-gray-200">Cable UTP: 300m</span>
                            <span class="px-2 py-1 bg-gray-100 rounded text-xs text-gray-600 border border-gray-200">Routers: 3</span>
                            <span class="px-2 py-1 bg-gray-100 rounded text-xs text-gray-600 border border-gray-200">Conectores: 50</span>
                        </div>
                    </div>
-->
                </div>

            </div>
        </form>

    </main>

    <!-- LOGICA JAVASCRIPT -->
    <script>
        // 1. Simulación de carga de datos (Mock Data)
        document.addEventListener('DOMContentLoaded', () => {
            // Datos simulados de la base de datos (InstallerSchema)
            const mockInstaller = {
                username: "juanperez",
                // password no se envía al frontend por seguridad
                name: "Juan",
                surname: "Perez",
                email: "juan.perez@servitel.com",
                phone: "0424-1234567",
                status: "active",
                onDuty: true,
                currentCrew: "crew_a" // ID simulado
            };

            // Rellenar campos
            document.getElementById('username').value = mockInstaller.username;
            document.getElementById('name').value = mockInstaller.name;
            document.getElementById('surname').value = mockInstaller.surname;
            document.getElementById('email').value = mockInstaller.email;
            document.getElementById('phone').value = mockInstaller.phone;
            
            // Selects y Checks
            document.getElementById('status').value = mockInstaller.status;
            document.getElementById('onDuty').checked = mockInstaller.onDuty;
            document.getElementById('currentCrew').value = mockInstaller.currentCrew;

            updateHeaderBadge();
        });

        // 2. Funciones de UI
        function togglePassword() {
            const input = document.getElementById('password');
            const icon = document.getElementById('eyeIcon');
            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = "password";
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function updateHeaderBadge() {
            const status = document.getElementById('status').value;
            const badge = document.getElementById('headerStatusBadge');
            
            if (status === 'active') {
                badge.className = "px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700 border border-green-200";
                badge.innerText = "ACTIVO";
            } else {
                badge.className = "px-3 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-500 border border-gray-200";
                badge.innerText = "INACTIVO";
            }
        }

        // 3. Guardar Cambios
        function guardarCambios(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            
            // Recopilar datos
            const data = {
                name: document.getElementById('name').value,
                surname: document.getElementById('surname').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                password: document.getElementById('password').value, // Solo si se cambió
                status: document.getElementById('status').value,
                onDuty: document.getElementById('onDuty').checked,
                currentCrew: document.getElementById('currentCrew').value
            };

            console.log("Guardando Instalador...", data);

            // UI Loading
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Guardando...';
            btn.classList.add('opacity-75', 'cursor-not-allowed');

            // Simular petición API
            setTimeout(() => {
                alert("¡Datos del instalador actualizados correctamente!");
                btn.disabled = false;
                btn.innerHTML = originalText;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');
                
                // Si asignamos cuadrilla, mostrar un feedback extra
                if (data.currentCrew) {
                    console.log(`Asignado a cuadrilla: ${data.currentCrew}`);
                }
            }, 1000);
        }
    </script>
</body>
</html>